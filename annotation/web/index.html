<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Secret Hitler – Persuasion Annotation</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header>
    <h1>Interactive Persuasion Annotation</h1>
    <p>Annotate messages with persuasion techniques from a JSONL categories file. Select input JSON with chats, categories JSONL, desired output filename, and number of samples, then start annotating.</p>
  </header>

  <section id="setup">
    <h2>Setup</h2>
    <form id="setup-form">
      <div class="form-row">
        <label for="inputFile">Input folder (JSON files):</label>
        <input type="file" id="inputFile" webkitdirectory directory multiple required />
      </div>
      <div class="form-row">
          <label for="categoriesFile">Categories (JSONL file):</label>
          <input type="file" id="categoriesFile" accept=".jsonl,application/jsonl,text/plain,application/octet-stream" required />
      </div>
      <div class="form-row">
        <label for="outputSuffix">Output suffix:</label>
        <input type="text" id="outputSuffix" placeholder="-chat-annotated" value="-chat-annotated" />
      </div>
      <div class="form-row">
        <label for="sampleCount">Number of files (alphabetical):</label>
        <input type="number" id="sampleCount" min="1" step="1" value="10" />
      </div>
      <div class="form-row">
        <label for="seedInput">Shuffle seed:</label>
        <input type="text" id="seedInput" placeholder="0" value="0" />
      </div>
      <div class="form-row">
        <button type="submit" id="startBtn">Start annotation</button>
      </div>
    </form>
    <p class="hint">Tip: Categories JSONL must have lines with objects including at least the field <code>ss_technique</code>. Optional: <code>ss_definition</code> and <code>ss_example</code> will show as tooltips.</p>
  </section>

  <section id="annotator" class="hidden">
    <div class="annotator-header">
      <div>
        <h2>Annotate</h2>
        <div id="progress">Sample 0 / 0</div>
      </div>
      <div class="controls">
    <button id="prevBtn" class="hidden" title="Go to previous sample" disabled>Previous</button>
  <button id="nextBtn" class="hidden" title="Save & go to next sample" disabled>Save & Next</button>
        <button id="finishBtn" class="primary" title="Finish and download results" disabled>Finish & Download</button>
      </div>
    </div>

    <div class="layout">
      <main class="context-panel">
  <h3>Context</h3>
        <div id="context" class="context-list"></div>
      </main>
    </div>

    <section class="techniques-panel">
      <div class="techniques-header">
        <h3>Techniques</h3>
        <div class="techniques-actions">
          <input type="text" id="techSearch" placeholder="Filter…" />
          <button id="noneBtn" title="Clear all selections for this message">None</button>
        </div>
      </div>
      <div id="techniques" class="techniques-list" aria-live="polite"></div>
    </section>
  </section>

  <footer>
    <small>All processing happens locally in your browser. No data leaves your machine.</small>
  </footer>

  <script src="./app.js"></script>
</body>
</html>
